<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>碰撞检测</title>
</head>

<body>
  <h2>基于几何图形的碰撞检测</h2>
  <canvas id="canvas" width="400" height="400" style="border:1px solid #ff0000"></canvas>
  <textarea id="log" cols="30" rows="10"></textarea>
  <script src="utils.js"></script>
  <!-- <script src="ball.js"></script> -->
  <script src="box.js"></script>
  <script>
    window.onload = function () {
      var canvas = document.getElementById('canvas')
      var context = canvas.getContext('2d')
      var boxes = []
      var activeBox = createBox()
      var gravity = 0.2

      function createBox() {
        var box = new Box(Math.random() * 40 + 10, Math.random() * 40 + 10)
        box.x = Math.random() * canvas.width
        boxes.push(box)
        return box
      }

      function drawBox(box) {
        if (activeBox !== box && utils.intersects(activeBox, box)) {
          activeBox.y = box.y - activeBox.height
          activeBox = createBox()

        }
        box.draw(context)
      }

      ;
      (function drawFrame() {
        window.requestAnimationFrame(drawFrame, canvas)
        context.clearRect(0, 0, canvas.width, canvas.height)

        activeBox.vy += gravity
        activeBox.y += activeBox.vy

        if (activeBox.y + activeBox.height > canvas.height) {
          activeBox.y = canvas.height - activeBox.height
          activeBox = createBox()
        }
        boxes.forEach(drawBox)
      }())


    }

  </script>
</body>

</html>
